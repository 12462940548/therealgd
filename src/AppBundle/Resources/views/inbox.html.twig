{% extends '@RadditApp/base.html.twig' %}

{% block head %}
  {% include '@RadditApp/includes/meta_pagination.html.twig' with {pager: notifications} %}
{% endblock %}

{% block page_classes %}
  inbox-page
{% endblock %}

{% block title %}
  {{ 'inbox.title'|trans }}
{% endblock %}

{% block body %}
  <h1>{{ 'inbox.title'|trans }}</h1>

  {% if notifications|length > 0 %}
    <form action="{{ path('raddit_app_clear_inbox', { max: notifications|first.id }) }}" method="POST" class="form">
      <input type="hidden" name="token" value="{{ csrf_token('clear_inbox') }}">
      <div class="row">
        <button type="submit" class="button">{{ 'inbox.clear_inbox'|trans }}</button>
      </div>
    </form>
  {% else %}
    <p>{{ 'inbox.empty'|trans }}</p>
  {% endif %}

  {% for notification in notifications %}
    {{ block('notification_'~notification.type) }}
  {% endfor %}

  {% include '@RadditApp/includes/pagination.html.twig' with {pager: notifications} %}
{% endblock %}

{% block notification_comment %}
  {% from '@RadditApp/macros/comments.html.twig' import comment %}

  {{ comment(notification.comment, false) }}
{% endblock %}

{% block notification_message_thread %}
  {% from '@RadditApp/macros/messages.html.twig' import message_thread %}

  <h1 class="notification-head">
    <a href="{{ path('raddit_app_message', {id: notification.thread.id}) }}">
      {{- notification.thread.title -}}
    </a>
  </h1>

  {{ message_thread(notification.thread, {recursive: false}) }}
{% endblock %}

{% block notification_message_reply %}
  {% from '@RadditApp/macros/messages.html.twig' import message_reply %}

  <h1 class="notification-head">
    <a href="{{ path('raddit_app_message', {id: notification.reply.thread.id}) }}#mr{{ notification.reply.id }}">
      {{ 'inbox.message_reply_head'|trans({'%title%': notification.reply.thread.title}) -}}
    </a>
  </h1>

  {{ message_reply(notification.reply) }}
{% endblock %}
